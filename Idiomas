local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local localPlayer = Players.LocalPlayer

-- ESTADO GLOBAL DEL ESCUDO
local SHIELD_ACTIVE = false

-- Almac√©n para el estado original del personaje
local originalDescription = nil

-- ========= CREACI√ìN DE LA INTERFAZ GR√ÅFICA (GUI) =========
-- (El c√≥digo de la GUI es el mismo, no es necesario cambiarlo)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "EscudoAvatarGUIv6"
screenGui.ResetOnSpawn = false
screenGui.Parent = localPlayer:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 220, 0, 80)
mainFrame.Position = UDim2.new(0.5, -110, 0.2, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
mainFrame.BorderColor3 = Color3.fromRGB(120, 120, 120)
mainFrame.Parent = screenGui

local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
titleBar.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, 0, 1, 0)
titleLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.BackgroundTransparency = 1
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Text = "Escudo de Avatar v6"
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 16
titleLabel.Parent = titleBar

local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(1, -20, 1, -40)
toggleButton.Position = UDim2.new(0, 10, 0, 35)
toggleButton.BackgroundColor3 = Color3.fromRGB(224, 73, 73)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Text = "Activar Escudo"
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 18
toggleButton.Parent = mainFrame

-- L√≥gica para arrastrar la ventana
local dragging = false
local dragInput, dragStart, startPos
titleBar.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then dragging, dragStart, startPos = true, input.Position, mainFrame.Position; input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end) end end)
titleBar.InputChanged:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end end)
UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragging then local delta = input.Position - dragStart; mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y) end end)

-- ========= L√ìGICA DE PROTECCI√ìN MULTI-CAPA =========

-- Guardamos la descripci√≥n original cuando el personaje aparece
localPlayer.CharacterAdded:Connect(function(character)
    task.wait(1) -- Damos tiempo a que todo cargue
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        originalDescription = humanoid:GetAppliedDescription()
    end
end)
if localPlayer.Character then
    local humanoid = localPlayer.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        originalDescription = humanoid:GetAppliedDescription()
    end
end

-- Funci√≥n para restaurar todo a la normalidad
local function restaurarNormalidad()
    local character = localPlayer.Character
    if not character then return end
    
    -- Restaurar Body Colors
    local trampa = character:FindFirstChild("Body Colors")
    if trampa and trampa:IsA("StringValue") then trampa:Destroy() end
    local realBodyColors = character:FindFirstChild("RealBodyColors_Protected")
    if realBodyColors then realBodyColors.Name = "Body Colors" end
    
    -- Restaurar HumanoidDescription
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid and originalDescription then
        humanoid:ApplyDescription(originalDescription)
    end
    print("Sistemas restaurados a la normalidad.")
end

--- CAPA 1: TRAMPA DE BODY COLORS (DOBLE BUCLE) ---
local function iniciarBucleBodyColors(desync_wait)
    task.spawn(function()
        task.wait(desync_wait) -- Desincronizaci√≥n inicial
        while SHIELD_ACTIVE do
            local character = localPlayer.Character
            if character and character.Parent then
                local realBodyColors = character:FindFirstChild("Body Colors")
                if realBodyColors and realBodyColors:IsA("BodyColors") then
                    realBodyColors.Name = "RealBodyColors_Protected"
                end
                if not character:FindFirstChild("Body Colors") then
                    local fake = Instance.new("StringValue")
                    fake.Name = "Body Colors"
                    fake.Parent = character
                end
            end
            task.wait(0.1)
        end
    end)
end

--- CAPA 2: ANULACI√ìN DE HUMANOIDDESCRIPTION ---
local function iniciarBucleDescripcion()
    task.spawn(function()
        while SHIELD_ACTIVE do
            local character = localPlayer.Character
            if character and character.Parent then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    -- Reemplazamos la propiedad constantemente
                    humanoid.HumanoidDescription = Instance.new("HumanoidDescription")
                end
            end
            task.wait(0.25)
        end
    end)
end

--- CAPA 3: GENERADOR DE RUIDO ---
local function iniciarBucleDeRuido()
    task.spawn(function()
        while SHIELD_ACTIVE do
            local character = localPlayer.Character
            if character and character.Parent then
                local fakeAccessory = Instance.new("Accessory")
                fakeAccessory.Parent = character
                fakeAccessory:Destroy()
            end
            task.wait() -- Se ejecuta en cada frame para m√°ximo ruido
        end
    end)
end

-- El bot√≥n que controla todo
toggleButton.MouseButton1Click:Connect(function()
    SHIELD_ACTIVE = not SHIELD_ACTIVE
    
    if SHIELD_ACTIVE then
        toggleButton.Text = "Escudo Activado"
        toggleButton.BackgroundColor3 = Color3.fromRGB(73, 224, 84)
        
        -- Iniciar todos los bucles de protecci√≥n
        iniciarBucleBodyColors(0)    -- Bucle 1A
        iniciarBucleBodyColors(0.05) -- Bucle 1B (desincronizado)
        iniciarBucleDescripcion()    -- Bucle 2
        iniciarBucleDeRuido()        -- Bucle 3
        
        print("üõ°Ô∏è Escudo Multi-Capa ACTIVADO. 4 bucles de protecci√≥n en ejecuci√≥n.")
    else
        toggleButton.Text = "Activar Escudo"
        toggleButton.BackgroundColor3 = Color3.fromRGB(224, 73, 73)
        restaurarNormalidad()
        print("Escudo DESACTIVADO. Todos los bucles detenidos.")
    end
end)

screenGui.Destroying:Connect(function()
    SHIELD_ACTIVE = false
    restaurarNormalidad()
end)

print("‚úÖ Escudo Interactivo v6 (Multi-Capa) cargado y listo.")
